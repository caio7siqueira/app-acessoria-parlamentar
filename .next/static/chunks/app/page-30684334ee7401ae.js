(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2894:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(2898);let n=(0,s.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},7916:function(e,t,a){Promise.resolve().then(a.bind(a,2323))},2323:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Home}});var s=a(7437),n=a(5403),r=a(4033),i=a(2265),c=a(8113),o=a(4874),l=a(2099),d=a(7619),m=a(2894),u=a(6141),h=a(5750);function DashboardPage(){let e=(0,r.useRouter)(),{data:t,isLoading:a}=(0,o.a)({queryKey:["dashboard-stats"],queryFn:()=>l.s.obterEstatisticas()});if(a||!t)return(0,s.jsx)("div",{className:"animate-pulse",children:(0,s.jsx)("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:Array.from({length:4}).map((e,t)=>(0,s.jsx)("div",{className:"bg-gray-200 rounded-lg h-32"},t))})});let n=[{id:"total",title:"Total de Atendimentos",value:t.total_atendimentos,icon:d.Z,color:"bg-blue-500",textColor:"text-blue-600",bgColor:"bg-blue-50",href:"/atendimentos"},{id:"urgentes",title:"Atendimentos Urgentes",value:t.atendimentos_urgentes,icon:m.Z,color:"bg-red-500",textColor:"text-red-600",bgColor:"bg-red-50",href:"/atendimentos?urgencia=Urgente"},{id:"prazo",title:"Pr\xf3ximos do Prazo",value:t.atendimentos_prazo,icon:u.Z,color:"bg-yellow-500",textColor:"text-yellow-600",bgColor:"bg-yellow-50",href:"/atendimentos?prazo=proximo"},{id:"mes",title:"Atendimentos do M\xeas",value:t.total_atendimentos,icon:h.Z,color:"bg-green-500",textColor:"text-green-600",bgColor:"bg-green-50",href:"/atendimentos?periodo=mes"}];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Vis\xe3o geral dos atendimentos e demandas"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:n.map(t=>(0,s.jsx)("button",{onClick:()=>e.push(t.href),className:"bg-white overflow-hidden shadow-sm hover:shadow-md rounded-2xl transition-all duration-200 hover:scale-105 active:scale-100 text-left",children:(0,s.jsx)("div",{className:"p-5",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"p-3 rounded-xl ".concat(t.bgColor),children:(0,s.jsx)(t.icon,{className:"h-6 w-6 ".concat(t.textColor)})})}),(0,s.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,s.jsxs)("dl",{children:[(0,s.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:t.title}),(0,s.jsx)("dd",{className:"text-2xl font-semibold text-gray-900",children:t.value})]})})]})})},t.id))}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Atendimentos por Status"}),(0,s.jsx)("div",{className:"space-y-3",children:t.atendimentos_por_status.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:e.status}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"".concat(e.quantidade/t.total_atendimentos*100,"%")}})}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-900 w-8",children:e.quantidade})]})]},e.status))})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Atendimentos por Canal"}),(0,s.jsx)("div",{className:"space-y-3",children:t.atendimentos_por_canal.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:e.canal}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"".concat(e.quantidade/t.total_atendimentos*100,"%")}})}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-900 w-8",children:e.quantidade})]})]},e.canal))})]})]}),(0,s.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Atividades Recentes"}),(0,s.jsx)("div",{className:"flow-root",children:(0,s.jsxs)("div",{className:"text-sm text-gray-500 text-center py-4",children:["Sistema implementado com sucesso!",(0,s.jsx)("br",{}),"Dados em tempo real sendo carregados..."]})})]})})]})}function Home(){let{user:e,loading:t}=(0,n.a)(),a=(0,r.useRouter)();return((0,i.useEffect)(()=>{t||e||a.push("/login")},[e,t,a]),t)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e?(0,s.jsx)(c.c,{children:(0,s.jsx)(DashboardPage,{})}):null}},2099:function(e,t,a){"use strict";a.d(t,{s:function(){return AtendimentosService}});var s=a(7893);let n=(0,s.eI)("https://ivoxmhxcssydnfgormwn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2b3htaHhjc3N5ZG5mZ29ybXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyMzUwMDYsImV4cCI6MjA3NzgxMTAwNn0.NLzp7E7pyyNPTmdXn63dQExDAA88bTTsyccB_Ba_CJM");let AtendimentosService=class AtendimentosService{static async buscarAtendimentos(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{page:1,limit:10},a=n.from("atendimentos").select("*",{count:"exact"});e.status&&e.status.length>0&&(a=a.in("status",e.status)),e.urgencia&&e.urgencia.length>0&&(a=a.in("prazo_urgencia",e.urgencia)),e.secretaria&&e.secretaria.length>0&&(a=a.in("secretaria",e.secretaria)),e.canal&&e.canal.length>0&&(a=a.in("canal",e.canal)),e.data_inicio&&(a=a.gte("data_criacao",e.data_inicio)),e.data_fim&&(a=a.lte("data_criacao",e.data_fim)),e.busca&&(a=a.or("nome.ilike.%".concat(e.busca,"%,solicitacao.ilike.%").concat(e.busca,"%")));let s=t.orderBy||"data_criacao",r=t.orderDirection||"desc";a=a.order(s,{ascending:"asc"===r});let i=(t.page-1)*t.limit,c=i+t.limit-1;a=a.range(i,c);let{data:o,error:l,count:d}=await a;if(l)throw Error("Erro ao buscar atendimentos: ".concat(l.message));return{data:o||[],total:d||0,page:t.page,limit:t.limit,totalPages:Math.ceil((d||0)/t.limit)}}static async buscarPorId(e){let{data:t,error:a}=await n.from("atendimentos").select("*").eq("id",e).single();if(a){if("PGRST116"===a.code)return null;throw Error("Erro ao buscar atendimento: ".concat(a.message))}return t}static async criar(e){let{data:{user:t}}=await n.auth.getUser(),{data:a,error:s}=await n.from("atendimentos").insert({...e,usuario_criacao:null==t?void 0:t.id}).select().single();if(s)throw Error("Erro ao criar atendimento: ".concat(s.message));return a}static async atualizar(e,t){let{data:a,error:s}=await n.from("atendimentos").update(t).eq("id",e).select().single();if(s)throw Error("Erro ao atualizar atendimento: ".concat(s.message));return a}static async excluir(e){let{error:t}=await n.from("atendimentos").delete().eq("id",e);if(t)throw Error("Erro ao excluir atendimento: ".concat(t.message))}static async buscarHistorico(e){let{data:t,error:a}=await n.from("historico").select("\n        *,\n        usuarios(nome)\n      ").eq("id_atendimento",e).order("data_hora",{ascending:!1});if(a)throw Error("Erro ao buscar hist\xf3rico: ".concat(a.message));return t}static async obterEstatisticas(){let{count:e}=await n.from("atendimentos").select("*",{count:"exact",head:!0}),{count:t}=await n.from("atendimentos").select("*",{count:"exact",head:!0}).eq("prazo_urgencia","Urgente").neq("status","Conclu\xeddo"),a=new Date;a.setDate(a.getDate()+3);let{count:s}=await n.from("atendimentos").select("*",{count:"exact",head:!0}).lte("prazo_data",a.toISOString().split("T")[0]).neq("status","Conclu\xeddo"),{data:r}=await n.from("atendimentos").select("status"),i={};null==r||r.forEach(e=>{i[e.status]=(i[e.status]||0)+1});let c=Object.entries(i).map(e=>{let[t,a]=e;return{status:t,quantidade:a}}),{data:o}=await n.from("atendimentos").select("canal"),l={};null==o||o.forEach(e=>{l[e.canal]=(l[e.canal]||0)+1});let d=Object.entries(l).map(e=>{let[t,a]=e;return{canal:t,quantidade:a}}),{data:m}=await n.from("atendimentos").select("secretaria").not("secretaria","is",null),u={};null==m||m.forEach(e=>{e.secretaria&&(u[e.secretaria]=(u[e.secretaria]||0)+1)});let h=Object.entries(u).map(e=>{let[t,a]=e;return{secretaria:t,quantidade:a}}),{data:g}=await n.from("atendimentos").select("prazo_urgencia"),x={};null==g||g.forEach(e=>{x[e.prazo_urgencia]=(x[e.prazo_urgencia]||0)+1});let f=Object.entries(x).map(e=>{let[t,a]=e;return{urgencia:t,quantidade:a}});return{total_atendimentos:e||0,atendimentos_urgentes:t||0,atendimentos_prazo:s||0,atendimentos_por_status:c,atendimentos_por_canal:d,atendimentos_por_secretaria:h,atendimentos_por_urgencia:f}}static subscribeToChanges(e){return n.channel("atendimentos-changes").on("postgres_changes",{event:"*",schema:"public",table:"atendimentos"},e).subscribe()}}}},function(e){e.O(0,[35,406,529,874,113,971,472,744],function(){return e(e.s=7916)}),_N_E=e.O()}]);