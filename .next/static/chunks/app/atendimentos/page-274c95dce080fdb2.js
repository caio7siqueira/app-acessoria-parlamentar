(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[838],{3936:function(e,t,a){Promise.resolve().then(a.bind(a,3207))},3207:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return AtendimentosPage}});var r=a(7437),n=a(4874),s=a(4033),i=a(2099),o=a(8113),l=a(1981),c=a(6141),d=a(1827),u=a(2898);let m=(0,u.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),g=(0,u.Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),h=(0,u.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var p=a(6307),x=a(9253),f=a(4966);function AtendimentosPage(){let e=(0,s.useRouter)(),[t,a]=(0,f._)("atendimentos_busca",""),[u,y]=(0,f._)("atendimentos_paginacao",{page:1,limit:10}),{data:b,isLoading:w}=(0,n.a)({queryKey:["atendimentos",t,u],queryFn:()=>i.s.buscarAtendimentos({busca:t},u)}),getStatusColor=e=>({Pendente:"bg-yellow-100 text-yellow-800 border-yellow-200","Em Andamento":"bg-blue-100 text-blue-800 border-blue-200",Concluído:"bg-green-100 text-green-800 border-green-200",Cancelado:"bg-red-100 text-red-800 border-red-200"})[e]||"bg-gray-100 text-gray-800 border-gray-200",getUrgenciaIcon=e=>"Urgente"===e||"Alta"===e?(0,r.jsx)(l.Z,{className:"w-4 h-4 text-red-500"}):(0,r.jsx)(c.Z,{className:"w-4 h-4 text-gray-400"}),getUrgenciaColor=e=>({Baixa:"text-gray-600",Média:"text-yellow-600",Alta:"text-orange-600",Urgente:"text-red-600 font-semibold"})[e]||"text-gray-600";return(0,r.jsx)(o.c,{children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-neutral-900 pb-24 safe-area-bottom",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 bg-white dark:bg-neutral-900 border-b border-gray-200 dark:border-neutral-800 px-4 py-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Atendimentos"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Gerencie suas demandas"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(d.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,r.jsx)("input",{type:"text",placeholder:"Buscar por nome ou solicita\xe7\xe3o...",value:t,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-neutral-700 rounded-xl bg-gray-50 dark:bg-neutral-800 text-base text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all mobile-input"})]})]}),(0,r.jsxs)("div",{className:"px-4 py-4",children:[w?(0,r.jsx)("div",{className:"space-y-3",children:[1,2,3].map(e=>(0,r.jsxs)("div",{className:"bg-white dark:bg-neutral-800 rounded-xl p-4 animate-pulse border border-gray-100 dark:border-neutral-700",children:[(0,r.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-neutral-700 rounded w-3/4 mb-3"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-neutral-700 rounded w-full mb-2"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-neutral-700 rounded w-2/3"})]},e))}):(null==b?void 0:b.data.length)===0?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 dark:bg-neutral-800 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(d.Z,{className:"w-8 h-8 text-gray-400"})}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-300 text-lg font-medium",children:"Nenhum atendimento encontrado"}),(0,r.jsx)("p",{className:"text-gray-400 dark:text-gray-400 text-sm mt-1",children:"Tente ajustar sua busca"})]}):(0,r.jsx)(p.M,{mode:"popLayout",children:(0,r.jsx)("div",{className:"space-y-3",children:null==b?void 0:b.data.map((t,a)=>(0,r.jsxs)(x.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{delay:.05*a,duration:.2},onClick:()=>e.push("/atendimentos/".concat(t.id)),className:"bg-white dark:bg-neutral-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-neutral-700 active:scale-98 transition-all duration-200 cursor-pointer hover:shadow-md",role:"button","aria-label":"Ver detalhes do atendimento de ".concat(t.nome),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 truncate",children:t.nome}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mt-1",children:t.solicitacao})]}),(0,r.jsx)(m,{className:"w-5 h-5 text-gray-400 flex-shrink-0 ml-2"})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[(0,r.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ".concat(getStatusColor(t.status)),children:t.status}),t.prazo_urgencia&&(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium bg-gray-50 dark:bg-neutral-700/40 ".concat(getUrgenciaColor(t.prazo_urgencia)),children:[getUrgenciaIcon(t.prazo_urgencia),t.prazo_urgencia]}),t.canal&&(0,r.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 dark:bg-neutral-700/40 text-gray-700 dark:text-gray-200",children:t.canal})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400",children:[(0,r.jsx)(g,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:new Date(t.data_criacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})})]})]},t.id))})}),b&&b.totalPages>1&&(0,r.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,r.jsx)("button",{onClick:()=>y(e=>({...e,page:Math.max(1,e.page-1)})),disabled:1===u.page,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Anterior"}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["P\xe1gina ",u.page," de ",b.totalPages]}),(0,r.jsx)("button",{onClick:()=>y(e=>({...e,page:Math.min(b.totalPages,e.page+1)})),disabled:u.page===b.totalPages,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Pr\xf3xima"})]})]}),(0,r.jsx)(x.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.3,type:"spring",stiffness:260,damping:20},className:"fixed bottom-20 right-4 z-20 md:bottom-6 md:right-6",children:(0,r.jsxs)("button",{onClick:()=>e.push("/atendimentos/novo"),className:"flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-5 py-4 rounded-full shadow-lg hover:shadow-xl active:scale-95 transition-all duration-200 mobile-button","aria-label":"Novo atendimento",children:[(0,r.jsx)(h,{className:"w-6 h-6"}),(0,r.jsx)("span",{className:"font-semibold hidden sm:inline",children:"Novo"})]})})]})})}},4966:function(e,t,a){"use strict";a.d(t,{_:function(){return useLocalStorage}});var r=a(2265);function useLocalStorage(e,t){let[a,n]=(0,r.useState)(()=>{try{let a=window.localStorage.getItem(e);return a?JSON.parse(a):t}catch(e){return t}});return(0,r.useEffect)(()=>{try{window.localStorage.setItem(e,JSON.stringify(a))}catch(e){}},[e,a]),[a,n]}},2099:function(e,t,a){"use strict";a.d(t,{s:function(){return AtendimentosService}});var r=a(7893);let n=(0,r.eI)("https://ivoxmhxcssydnfgormwn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2b3htaHhjc3N5ZG5mZ29ybXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyMzUwMDYsImV4cCI6MjA3NzgxMTAwNn0.NLzp7E7pyyNPTmdXn63dQExDAA88bTTsyccB_Ba_CJM");let AtendimentosService=class AtendimentosService{static async buscarAtendimentos(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{page:1,limit:10},a=n.from("atendimentos").select("*",{count:"exact"});e.status&&e.status.length>0&&(a=a.in("status",e.status)),e.urgencia&&e.urgencia.length>0&&(a=a.in("prazo_urgencia",e.urgencia)),e.secretaria&&e.secretaria.length>0&&(a=a.in("secretaria",e.secretaria)),e.canal&&e.canal.length>0&&(a=a.in("canal",e.canal)),e.data_inicio&&(a=a.gte("data_criacao",e.data_inicio)),e.data_fim&&(a=a.lte("data_criacao",e.data_fim)),e.busca&&(a=a.or("nome.ilike.%".concat(e.busca,"%,solicitacao.ilike.%").concat(e.busca,"%")));let r=t.orderBy||"data_criacao",s=t.orderDirection||"desc";a=a.order(r,{ascending:"asc"===s});let i=(t.page-1)*t.limit,o=i+t.limit-1;a=a.range(i,o);let{data:l,error:c,count:d}=await a;if(c)throw Error("Erro ao buscar atendimentos: ".concat(c.message));return{data:l||[],total:d||0,page:t.page,limit:t.limit,totalPages:Math.ceil((d||0)/t.limit)}}static async buscarPorId(e){let{data:t,error:a}=await n.from("atendimentos").select("*").eq("id",e).single();if(a){if("PGRST116"===a.code)return null;throw Error("Erro ao buscar atendimento: ".concat(a.message))}return t}static async criar(e){let{data:{user:t}}=await n.auth.getUser(),{data:a,error:r}=await n.from("atendimentos").insert({...e,usuario_criacao:null==t?void 0:t.id}).select().single();if(r)throw Error("Erro ao criar atendimento: ".concat(r.message));return a}static async atualizar(e,t){let{data:a,error:r}=await n.from("atendimentos").update(t).eq("id",e).select().single();if(r)throw Error("Erro ao atualizar atendimento: ".concat(r.message));return a}static async excluir(e){let{error:t}=await n.from("atendimentos").delete().eq("id",e);if(t)throw Error("Erro ao excluir atendimento: ".concat(t.message))}static async buscarHistorico(e){let{data:t,error:a}=await n.from("historico").select("\n        *,\n        usuarios(nome)\n      ").eq("id_atendimento",e).order("data_hora",{ascending:!1});if(a)throw Error("Erro ao buscar hist\xf3rico: ".concat(a.message));return t}static async obterEstatisticas(){let{count:e}=await n.from("atendimentos").select("*",{count:"exact",head:!0}),{count:t}=await n.from("atendimentos").select("*",{count:"exact",head:!0}).eq("prazo_urgencia","Urgente").neq("status","Conclu\xeddo"),a=new Date;a.setDate(a.getDate()+3);let{count:r}=await n.from("atendimentos").select("*",{count:"exact",head:!0}).lte("prazo_data",a.toISOString().split("T")[0]).neq("status","Conclu\xeddo"),{data:s}=await n.from("atendimentos").select("status"),i={};null==s||s.forEach(e=>{i[e.status]=(i[e.status]||0)+1});let o=Object.entries(i).map(e=>{let[t,a]=e;return{status:t,quantidade:a}}),{data:l}=await n.from("atendimentos").select("canal"),c={};null==l||l.forEach(e=>{c[e.canal]=(c[e.canal]||0)+1});let d=Object.entries(c).map(e=>{let[t,a]=e;return{canal:t,quantidade:a}}),{data:u}=await n.from("atendimentos").select("secretaria").not("secretaria","is",null),m={};null==u||u.forEach(e=>{e.secretaria&&(m[e.secretaria]=(m[e.secretaria]||0)+1)});let g=Object.entries(m).map(e=>{let[t,a]=e;return{secretaria:t,quantidade:a}}),{data:h}=await n.from("atendimentos").select("prazo_urgencia"),p={};null==h||h.forEach(e=>{p[e.prazo_urgencia]=(p[e.prazo_urgencia]||0)+1});let x=Object.entries(p).map(e=>{let[t,a]=e;return{urgencia:t,quantidade:a}});return{total_atendimentos:e||0,atendimentos_urgentes:t||0,atendimentos_prazo:r||0,atendimentos_por_status:o,atendimentos_por_canal:d,atendimentos_por_secretaria:g,atendimentos_por_urgencia:x}}static subscribeToChanges(e){return n.channel("atendimentos-changes").on("postgres_changes",{event:"*",schema:"public",table:"atendimentos"},e).subscribe()}}},6307:function(e,t,a){"use strict";a.d(t,{M:function(){return AnimatePresence}});var r=a(7437),n=a(2265),s=a(781),i=a(961),o=a(538),l=a(8243),c=a(6119),d=a(5968);function setRef(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}let PopChildMeasure=class PopChildMeasure extends n.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,a=(0,c.R)(e)&&e.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=a-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}};function PopChild({children:e,isPresent:t,anchorX:a,root:s}){let i=(0,n.useId)(),o=(0,n.useRef)(null),l=(0,n.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,n.useContext)(d._),u=function(...e){return n.useCallback(function(...e){return t=>{let a=!1,r=e.map(e=>{let r=setRef(e,t);return a||"function"!=typeof r||(a=!0),r});if(a)return()=>{for(let t=0;t<r.length;t++){let a=r[t];"function"==typeof a?a():setRef(e[t],null)}}}}(...e),e)}(o,e?.ref);return(0,n.useInsertionEffect)(()=>{let{width:e,height:r,top:n,left:d,right:u}=l.current;if(t||!o.current||!e||!r)return;let m="left"===a?`left: ${d}`:`right: ${u}`;o.current.dataset.motionPopId=i;let g=document.createElement("style");c&&(g.nonce=c);let h=s??document.head;return h.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${r}px !important;
            ${m}px !important;
            top: ${n}px !important;
          }
        `),()=>{h.contains(g)&&h.removeChild(g)}},[t]),(0,r.jsx)(PopChildMeasure,{isPresent:t,childRef:o,sizeRef:l,children:n.cloneElement(e,{ref:u})})}let PresenceChild=({children:e,initial:t,isPresent:a,onExitComplete:s,custom:o,presenceAffectsLayout:c,mode:d,anchorX:u,root:m})=>{let g=(0,i.h)(newChildrenMap),h=(0,n.useId)(),p=!0,x=(0,n.useMemo)(()=>(p=!1,{id:h,initial:t,isPresent:a,custom:o,onExitComplete:e=>{for(let t of(g.set(e,!0),g.values()))if(!t)return;s&&s()},register:e=>(g.set(e,!1),()=>g.delete(e))}),[a,g,s]);return c&&p&&(x={...x}),(0,n.useMemo)(()=>{g.forEach((e,t)=>g.set(t,!1))},[a]),n.useEffect(()=>{a||g.size||!s||s()},[a]),"popLayout"===d&&(e=(0,r.jsx)(PopChild,{isPresent:a,anchorX:u,root:m,children:e})),(0,r.jsx)(l.O.Provider,{value:x,children:e})};function newChildrenMap(){return new Map}var u=a(7196);let getChildKey=e=>e.key||"";function onlyElements(e){let t=[];return n.Children.forEach(e,e=>{(0,n.isValidElement)(e)&&t.push(e)}),t}let AnimatePresence=({children:e,custom:t,initial:a=!0,onExitComplete:l,presenceAffectsLayout:c=!0,mode:d="sync",propagate:m=!1,anchorX:g="left",root:h})=>{let[p,x]=(0,u.oO)(m),f=(0,n.useMemo)(()=>onlyElements(e),[e]),y=m&&!p?[]:f.map(getChildKey),b=(0,n.useRef)(!0),w=(0,n.useRef)(f),j=(0,i.h)(()=>new Map),[v,N]=(0,n.useState)(f),[k,_]=(0,n.useState)(f);(0,o.L)(()=>{b.current=!1,w.current=f;for(let e=0;e<k.length;e++){let t=getChildKey(k[e]);y.includes(t)?j.delete(t):!0!==j.get(t)&&j.set(t,!1)}},[k,y.length,y.join("-")]);let C=[];if(f!==v){let e=[...f];for(let t=0;t<k.length;t++){let a=k[t],r=getChildKey(a);y.includes(r)||(e.splice(t,0,a),C.push(a))}return"wait"===d&&C.length&&(e=C),_(onlyElements(e)),N(f),null}let{forceRender:E}=(0,n.useContext)(s.p);return(0,r.jsx)(r.Fragment,{children:k.map(e=>{let n=getChildKey(e),s=(!m||!!p)&&(f===k||y.includes(n));return(0,r.jsx)(PresenceChild,{isPresent:s,initial:(!b.current||!!a)&&void 0,custom:t,presenceAffectsLayout:c,mode:d,root:h,onExitComplete:s?void 0:()=>{if(!j.has(n))return;j.set(n,!0);let e=!0;j.forEach(t=>{t||(e=!1)}),e&&(E?.(),_(w.current),m&&x?.(),l&&l())},anchorX:g,children:e},n)})})}}},function(e){e.O(0,[35,406,529,874,253,113,971,472,744],function(){return e(e.s=3936)}),_N_E=e.O()}]);