"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{8113:function(e,t,s){s.d(t,{c:function(){return DashboardLayout}});var a=s(7437),l=s(2265),n=s(5403),i=s(1396),r=s.n(i),o=s(4033),c=s(7480),d=s(7619),u=s(2741),x=s(2457),h=s(9409),m=s(5750),f=s(2549);let v=[{name:"Dashboard",href:"/",icon:c.Z},{name:"Atendimentos",href:"/atendimentos",icon:d.Z},{name:"Contatos",href:"/contatos",icon:u.Z},{name:"Relat\xf3rios",href:"/relatorios",icon:x.Z},{name:"Configura\xe7\xf5es",href:"/configuracoes",icon:h.Z}];function Sidebar(e){var t,s,l,i,c;let{onClose:d}=e,u=(0,o.usePathname)(),{user:x,signOut:h}=(0,n.a)(),handleSignOut=async()=>{await h(),d&&d()};return(0,a.jsxs)("div",{className:"flex h-full flex-col bg-white shadow-lg",children:[(0,a.jsxs)("div",{className:"flex h-16 items-center justify-between px-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(m.Z,{className:"h-8 w-8 text-blue-600"})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("h1",{className:"text-sm font-semibold text-gray-900",children:"Assessoria Parlamentar"})})]}),d&&(0,a.jsx)("button",{type:"button",className:"lg:hidden",onClick:d,children:(0,a.jsx)(f.Z,{className:"h-6 w-6 text-gray-400"})})]}),(0,a.jsx)("nav",{className:"flex-1 px-4 py-4 space-y-1",children:v.map(e=>{let t=u===e.href||u.startsWith(e.href+"/");return(0,a.jsxs)(r(),{href:e.href,onClick:d,className:"\n                group flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors\n                ".concat(t?"bg-blue-100 text-blue-900 border-r-2 border-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n              "),children:[(0,a.jsx)(e.icon,{className:"\n                  mr-3 h-5 w-5 flex-shrink-0\n                  ".concat(t?"text-blue-600":"text-gray-400 group-hover:text-gray-500","\n                ")}),e.name]},e.name)})}),(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:(null==x?void 0:null===(s=x.user_metadata)||void 0===s?void 0:null===(t=s.nome)||void 0===t?void 0:t[0])||(null==x?void 0:null===(i=x.email)||void 0===i?void 0:null===(l=i[0])||void 0===l?void 0:l.toUpperCase())})})}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:(null==x?void 0:null===(c=x.user_metadata)||void 0===c?void 0:c.nome)||"Usu\xe1rio"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 truncate",children:null==x?void 0:x.email})]})]}),(0,a.jsx)("button",{onClick:handleSignOut,className:"mt-3 w-full text-left px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors",children:"Sair"})]})]})}var N=s(8004),g=s(1827),b=s(1981),p=s(6141),j=s(3021),y=s(3525),_=s(2005),E=s(7461);function NotificationPanel(){let[e,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)([]),[i,r]=(0,l.useState)(0),o=(0,y.Ng)();(0,l.useEffect)(()=>{loadNotifications();let e=o.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notificacoes"},()=>loadNotifications()).subscribe();return()=>{try{var t;null===(t=o.removeChannel)||void 0===t||t.call(o,e)}catch(e){}}},[]);let loadNotifications=async()=>{try{let{data:e}=await o.from("notificacoes").select("*").order("created_at",{ascending:!1}).limit(10);e&&(n(e),r(e.filter(e=>!e.lida).length))}catch(e){console.warn("Erro carregando notifica\xe7\xf5es",e)}},markAsRead=async e=>{await o.from("notificacoes").update({lida:!0}).eq("id",e),loadNotifications()},markAllAsRead=async()=>{await o.from("notificacoes").update({lida:!0}).eq("lida",!1),loadNotifications()},getIcon=e=>{switch(e){case"urgente":return(0,a.jsx)(b.Z,{className:"text-red-500",size:20});case"prazo":return(0,a.jsx)(p.Z,{className:"text-orange-500",size:20});default:return(0,a.jsx)(j.Z,{className:"text-blue-500",size:20})}};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>t(!e),className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,a.jsx)(j.Z,{size:24,className:"text-gray-700"}),i>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:i})]}),e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>t(!1)}),(0,a.jsxs)("div",{className:"absolute right-0 top-12 w-96 max-w-[calc(100vw-2rem)] bg-white rounded-2xl shadow-2xl z-50 border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:"Notifica\xe7\xf5es"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[i>0&&(0,a.jsx)("button",{onClick:markAllAsRead,className:"text-sm text-blue-600 hover:text-blue-700",children:"Marcar todas como lidas"}),(0,a.jsx)("button",{onClick:()=>t(!1),children:(0,a.jsx)(f.Z,{size:20,className:"text-gray-500"})})]})]}),(0,a.jsx)("div",{className:"max-h-[70vh] overflow-y-auto",children:0===s.length?(0,a.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,a.jsx)(j.Z,{size:48,className:"mx-auto mb-4 opacity-30"}),(0,a.jsx)("p",{children:"Nenhuma notifica\xe7\xe3o"})]}):(0,a.jsx)("div",{className:"divide-y",children:s.map(e=>(0,a.jsx)("div",{className:"p-4 hover:bg-gray-50 cursor-pointer transition-colors ".concat(e.lida?"":"bg-blue-50"),onClick:()=>markAsRead(e.id),children:(0,a.jsxs)("div",{className:"flex gap-3",children:[getIcon(e.tipo),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.titulo}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.mensagem}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:(0,_.Z)(new Date(e.created_at),{addSuffix:!0,locale:E.F})})]}),!e.lida&&(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"})]})},e.id))})})]})]})]})}function Navbar(e){var t,s,l,i;let{onMenuClick:r}=e,{user:o}=(0,n.a)();return(0,a.jsx)("div",{className:"sticky top-0 z-10 bg-white shadow-sm border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex h-16 items-center justify-between px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("button",{type:"button",className:"lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100",onClick:r,children:(0,a.jsx)(N.Z,{className:"h-6 w-6"})}),(0,a.jsx)("div",{className:"flex-1 max-w-2xl mx-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(g.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar atendimentos...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(NotificationPanel,{}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-white",children:(null==o?void 0:null===(s=o.user_metadata)||void 0===s?void 0:null===(t=s.nome)||void 0===t?void 0:t[0])||(null==o?void 0:null===(i=o.email)||void 0===i?void 0:null===(l=i[0])||void 0===l?void 0:l.toUpperCase())})})})]})]})})}function AuthGuard(e){let{children:t}=e,[s,n]=(0,l.useState)(null),[i,r]=(0,l.useState)(!0),c=(0,o.useRouter)(),d=(0,y.Ng)();return((0,l.useEffect)(()=>{let checkUser=async()=>{try{let{data:{session:e}}=await d.auth.getSession();if(null==e?void 0:e.user)n(e.user);else{c.push("/login");return}}catch(e){console.error("Erro ao verificar autentica\xe7\xe3o:",e),c.push("/login");return}finally{r(!1)}};checkUser();let{data:{subscription:e}}=d.auth.onAuthStateChange(async(e,t)=>{var s;console.log("Auth state changed:",e,null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.email),"SIGNED_IN"===e&&(null==t?void 0:t.user)?(n(t.user),r(!1)):"SIGNED_OUT"===e&&(n(null),c.push("/login"))});return()=>e.unsubscribe()},[c,d]),i)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Verificando autentica\xe7\xe3o..."})]})}):s?(0,a.jsx)(a.Fragment,{children:t}):null}var A=s(6637),S=s(9993);function BottomNav(){let e=(0,o.usePathname)(),t=(0,o.useRouter)(),s=[{icon:c.Z,label:"Dashboard",href:"/"},{icon:A.Z,label:"Atendimentos",href:"/atendimentos"},{icon:m.Z,label:"Contatos",href:"/contatos"},{icon:S.Z,label:"Relat\xf3rios",href:"/relatorios"},{icon:h.Z,label:"Config",href:"/configuracoes"}];return(0,a.jsx)("nav",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-white border-t z-50 safe-area-bottom",children:(0,a.jsx)("div",{className:"flex justify-around items-center h-16",children:s.map(s=>{let{icon:l,label:n,href:i}=s,r=e===i;return(0,a.jsxs)("button",{onClick:()=>t.push(i),className:"flex flex-col items-center justify-center flex-1 h-full transition-colors active-scale ".concat(r?"text-primary-600":"text-gray-500 active:text-primary-600"),children:[(0,a.jsx)(l,{size:22,strokeWidth:r?2.5:2}),(0,a.jsx)("span",{className:"text-xs mt-1 ".concat(r?"font-semibold":"font-medium"),children:n})]},i)})})})}function DashboardLayout(e){let{children:t}=e,[s,n]=(0,l.useState)(!1);return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"hidden lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0",children:(0,a.jsx)(Sidebar,{})}),s&&(0,a.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>n(!1)}),(0,a.jsx)("div",{className:"relative flex w-full max-w-xs flex-col bg-white",children:(0,a.jsx)(Sidebar,{onClose:()=>n(!1)})})]}),(0,a.jsxs)("div",{className:"lg:pl-64",children:[(0,a.jsx)(Navbar,{onMenuClick:()=>n(!0)}),(0,a.jsx)("main",{className:"py-6 px-4 sm:px-6 lg:px-8 pb-20 md:pb-6",children:(0,a.jsx)(AuthGuard,{children:t})}),(0,a.jsx)(BottomNav,{})]})]})}},5403:function(e,t,s){s.d(t,{H:function(){return AuthProvider},a:function(){return useAuth}});var a=s(7437),l=s(2265),n=s(3525);let i=(0,l.createContext)({user:null,session:null,loading:!0,signOut:async()=>{}});function AuthProvider(e){let{children:t}=e,[s,r]=(0,l.useState)(null),[o,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(!0),x=(0,n.Ng)();(0,l.useEffect)(()=>{let getSession=async()=>{try{let{data:{session:e}}=await x.auth.getSession();c(e),r((null==e?void 0:e.user)||null)}catch(e){console.error("Erro ao obter sess\xe3o:",e)}finally{u(!1)}};getSession();let{data:{subscription:e}}=x.auth.onAuthStateChange(async(e,t)=>{console.log("Auth event:",e),c(t),r((null==t?void 0:t.user)||null),u(!1)});return()=>e.unsubscribe()},[x]);let signOut=async()=>{try{await x.auth.signOut(),r(null),c(null)}catch(e){console.error("Erro ao fazer logout:",e)}};return(0,a.jsx)(i.Provider,{value:{user:s,session:o,loading:d,signOut},children:t})}let useAuth=()=>{let e=(0,l.useContext)(i);if(!e)throw Error("useAuth deve ser usado dentro de AuthProvider");return e}},3525:function(e,t,s){s.d(t,{Ng:function(){return getSupabaseClient}});var a=s(7893),l=s(2601);function validateEnvironment(){let e={NEXT_PUBLIC_SUPABASE_URL:"https://ivoxmhxcssydnfgormwn.supabase.co",NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2b3htaHhjc3N5ZG5mZ29ybXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyMzUwMDYsImV4cCI6MjA3NzgxMTAwNn0.NLzp7E7pyyNPTmdXn63dQExDAA88bTTsyccB_Ba_CJM",NEXTAUTH_URL:"http://localhost:3000",NEXTAUTH_SECRET:"placeholder-for-client"},t={SUPABASE_SERVICE_ROLE_KEY:l.env.SUPABASE_SERVICE_ROLE_KEY,NEXT_PUBLIC_VAPID_PUBLIC_KEY:"1g138W2+IoKWZCG8UaT066dDvB9WRCT7/cC31PBI4STjHe27Qh7+w7MVoBn3q4iEBplinpZ458c3vuFLx2VFFEU=",VAPID_PRIVATE_KEY:l.env.VAPID_PRIVATE_KEY},s=[];if(e.NEXT_PUBLIC_SUPABASE_URL&&""!==e.NEXT_PUBLIC_SUPABASE_URL.trim()||s.push("NEXT_PUBLIC_SUPABASE_URL"),e.NEXT_PUBLIC_SUPABASE_ANON_KEY&&""!==e.NEXT_PUBLIC_SUPABASE_ANON_KEY.trim()||s.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),s.length>0){let e=["❌ Missing required environment variables (".concat("client","): ").concat(s.join(", ")),"","\uD83D\uDCDD Please add these variables to your .env.local file:",...s.map(e=>"   ".concat(e,"=your_value_here")),"","\uD83D\uDCD6 Check the .env.example file for reference."].join("\n");throw Error(e)}try{e.NEXT_PUBLIC_SUPABASE_URL&&new URL(e.NEXT_PUBLIC_SUPABASE_URL)}catch(e){throw Error("❌ Invalid URL format in environment variables. Please check NEXT_PUBLIC_SUPABASE_URL and NEXTAUTH_URL.")}return{supabaseUrl:e.NEXT_PUBLIC_SUPABASE_URL,supabaseAnonKey:e.NEXT_PUBLIC_SUPABASE_ANON_KEY,nextAuthUrl:e.NEXTAUTH_URL,nextAuthSecret:e.NEXTAUTH_SECRET,supabaseServiceRoleKey:t.SUPABASE_SERVICE_ROLE_KEY,vapidPublicKey:t.NEXT_PUBLIC_VAPID_PUBLIC_KEY,vapidPrivateKey:t.VAPID_PRIVATE_KEY}}let n=null,i=null;function getSupabaseClient(){if(!n){let e=validateEnvironment();n=(0,a.eI)(e.supabaseUrl,e.supabaseAnonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},realtime:{params:{eventsPerSecond:10}}})}return n}getSupabaseClient(),function(){if(!i){let e=validateEnvironment();e.supabaseServiceRoleKey&&(i=(0,a.eI)(e.supabaseUrl,e.supabaseServiceRoleKey,{auth:{autoRefreshToken:!1,persistSession:!1}}))}}()}}]);