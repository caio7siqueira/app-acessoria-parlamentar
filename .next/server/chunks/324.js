"use strict";exports.id=324,exports.ids=[324],exports.modules={7324:(t,e,a)=>{a.d(e,{s:()=>AtendimentosService});var i=a(3682);let r=(0,i.createClient)("https://ivoxmhxcssydnfgormwn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2b3htaHhjc3N5ZG5mZ29ybXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyMzUwMDYsImV4cCI6MjA3NzgxMTAwNn0.NLzp7E7pyyNPTmdXn63dQExDAA88bTTsyccB_Ba_CJM");let AtendimentosService=class AtendimentosService{static async buscarAtendimentos(t={},e={page:1,limit:10}){let a=r.from("atendimentos").select("*",{count:"exact"});t.status&&t.status.length>0&&(a=a.in("status",t.status)),t.urgencia&&t.urgencia.length>0&&(a=a.in("prazo_urgencia",t.urgencia)),t.secretaria&&t.secretaria.length>0&&(a=a.in("secretaria",t.secretaria)),t.canal&&t.canal.length>0&&(a=a.in("canal",t.canal)),t.data_inicio&&(a=a.gte("data_criacao",t.data_inicio)),t.data_fim&&(a=a.lte("data_criacao",t.data_fim)),t.busca&&(a=a.or(`nome.ilike.%${t.busca}%,solicitacao.ilike.%${t.busca}%`));let i=e.orderBy||"data_criacao",s=e.orderDirection||"desc";a=a.order(i,{ascending:"asc"===s});let n=(e.page-1)*e.limit,o=n+e.limit-1;a=a.range(n,o);let{data:c,error:l,count:d}=await a;if(l)throw Error(`Erro ao buscar atendimentos: ${l.message}`);return{data:c||[],total:d||0,page:e.page,limit:e.limit,totalPages:Math.ceil((d||0)/e.limit)}}static async buscarPorId(t){let{data:e,error:a}=await r.from("atendimentos").select("*").eq("id",t).single();if(a){if("PGRST116"===a.code)return null;throw Error(`Erro ao buscar atendimento: ${a.message}`)}return e}static async criar(t){let{data:{user:e}}=await r.auth.getUser(),{data:a,error:i}=await r.from("atendimentos").insert({...t,usuario_criacao:e?.id}).select().single();if(i)throw Error(`Erro ao criar atendimento: ${i.message}`);return a}static async atualizar(t,e){let{data:a,error:i}=await r.from("atendimentos").update(e).eq("id",t).select().single();if(i)throw Error(`Erro ao atualizar atendimento: ${i.message}`);return a}static async excluir(t){let{error:e}=await r.from("atendimentos").delete().eq("id",t);if(e)throw Error(`Erro ao excluir atendimento: ${e.message}`)}static async buscarHistorico(t){let{data:e,error:a}=await r.from("historico").select(`
        *,
        usuarios(nome)
      `).eq("id_atendimento",t).order("data_hora",{ascending:!1});if(a)throw Error(`Erro ao buscar hist\xf3rico: ${a.message}`);return e}static async obterEstatisticas(){let{count:t}=await r.from("atendimentos").select("*",{count:"exact",head:!0}),{count:e}=await r.from("atendimentos").select("*",{count:"exact",head:!0}).eq("prazo_urgencia","Urgente").neq("status","Conclu\xeddo"),a=new Date;a.setDate(a.getDate()+3);let{count:i}=await r.from("atendimentos").select("*",{count:"exact",head:!0}).lte("prazo_data",a.toISOString().split("T")[0]).neq("status","Conclu\xeddo"),{data:s}=await r.from("atendimentos").select("status"),n={};s?.forEach(t=>{n[t.status]=(n[t.status]||0)+1});let o=Object.entries(n).map(([t,e])=>({status:t,quantidade:e})),{data:c}=await r.from("atendimentos").select("canal"),l={};c?.forEach(t=>{l[t.canal]=(l[t.canal]||0)+1});let d=Object.entries(l).map(([t,e])=>({canal:t,quantidade:e})),{data:m}=await r.from("atendimentos").select("secretaria").not("secretaria","is",null),u={};m?.forEach(t=>{t.secretaria&&(u[t.secretaria]=(u[t.secretaria]||0)+1)});let g=Object.entries(u).map(([t,e])=>({secretaria:t,quantidade:e})),{data:h}=await r.from("atendimentos").select("prazo_urgencia"),p={};h?.forEach(t=>{p[t.prazo_urgencia]=(p[t.prazo_urgencia]||0)+1});let _=Object.entries(p).map(([t,e])=>({urgencia:t,quantidade:e}));return{total_atendimentos:t||0,atendimentos_urgentes:e||0,atendimentos_prazo:i||0,atendimentos_por_status:o,atendimentos_por_canal:d,atendimentos_por_secretaria:g,atendimentos_por_urgencia:_}}static subscribeToChanges(t){return r.channel("atendimentos-changes").on("postgres_changes",{event:"*",schema:"public",table:"atendimentos"},t).subscribe()}}}};