(()=>{var e={};e.id=223,e.ids=[223],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},6300:(e,a,r)=>{"use strict";r.r(a),r.d(a,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>d,routeModule:()=>m,tree:()=>c});var t=r(7096),s=r(6132),i=r(7284),l=r.n(i),n=r(2564),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(a,o);let c=["",{children:["relatorios",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5546)),"/workspaces/app-acessoria-parlamentar/src/app/relatorios/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2594)),"/workspaces/app-acessoria-parlamentar/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],d=["/workspaces/app-acessoria-parlamentar/src/app/relatorios/page.tsx"],x="/relatorios/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/relatorios/page",pathname:"/relatorios",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4587:(e,a,r)=>{Promise.resolve().then(r.bind(r,2667))},2667:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>RelatoriosPage});var t=r(784),s=r(9885),i=r(3993),l=r(6658),n=r(5304),o=r(7040),c=r(7505),d=r(3682),x=r(8973);let u=(0,d.createClient)("https://ivoxmhxcssydnfgormwn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2b3htaHhjc3N5ZG5mZ29ybXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyMzUwMDYsImV4cCI6MjA3NzgxMTAwNn0.NLzp7E7pyyNPTmdXn63dQExDAA88bTTsyccB_Ba_CJM");let RelatoriosService=class RelatoriosService{static async gerarRelatorio(e){try{if(!e.data_inicio||!e.data_fim)throw Error("Datas de in\xedcio e fim s\xe3o obrigat\xf3rias.");let a=e.data_inicio,r=`${e.data_fim} 23:59:59`,t=u.from("atendimentos").select("*").gte("data_criacao",a).lte("data_criacao",r).order("data_criacao",{ascending:!1});e.secretarias&&e.secretarias.length>0&&(t=t.in("secretaria",e.secretarias)),e.status&&e.status.length>0&&(t=t.in("status",e.status)),e.urgencia&&e.urgencia.length>0&&(t=t.in("prazo_urgencia",e.urgencia));let{data:s,error:i}=await t;if(i)throw console.error("Erro na query de relat\xf3rio:",i),Error(x.X.ERROR.RELATORIO_GENERATE);return s||[]}catch(e){throw console.error("Erro ao gerar relat\xf3rio:",e),Error(e.message||x.X.ERROR.RELATORIO_GENERATE)}}static async exportarPDF(e){return this.exportarCSV(e)}static async exportarExcel(e){return this.exportarCSV(e)}static async exportarCSV(e){let a=await this.gerarRelatorio({...e,formato:"pdf"}),r=a.map(e=>[e.id,`"${e.nome?.replace(/"/g,'""')||""}"`,e.genero,`"${e.endereco?.replace(/"/g,'""')||""}"`,e.idade||"",e.telefone||"",`"${e.solicitacao?.replace(/"/g,'""')||""}"`,e.prazo_data||"",e.prazo_urgencia,e.encaminhamento,e.secretaria||"",e.status,e.canal,new Date(e.data_criacao).toLocaleString("pt-BR")].join(",")),t=["ID,Nome,G\xeanero,Endere\xe7o,Idade,Telefone,Solicita\xe7\xe3o,Prazo,Urg\xeancia,Encaminhamento,Secretaria,Status,Canal,Data Cria\xe7\xe3o",...r].join("\n"),s=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"});return s}static baixarArquivo(e,a){let r=window.URL.createObjectURL(e),t=document.createElement("a");t.href=r,t.download=a,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(r)}static async obterEstatisticasRelatorio(e){try{let a=await this.gerarRelatorio({...e,formato:"pdf"});if(!a||0===a.length)return{periodo:{inicio:e.data_inicio,fim:e.data_fim},resumo:{total_atendimentos:0,atendimentos_urgentes:0,atendimentos_concluidos:0,taxa_conclusao:0},distribuicao:{por_status:[],por_urgencia:[],por_canal:[],por_secretaria:[]}};let r=a.length,t=a.reduce((e,a)=>(e[a.status]=(e[a.status]||0)+1,e),{}),s=a.reduce((e,a)=>(e[a.prazo_urgencia]=(e[a.prazo_urgencia]||0)+1,e),{}),i=a.reduce((e,a)=>(e[a.canal]=(e[a.canal]||0)+1,e),{}),l=a.reduce((e,a)=>(a.secretaria&&(e[a.secretaria]=(e[a.secretaria]||0)+1),e),{}),n=a.filter(e=>"Urgente"===e.prazo_urgencia&&"Conclu\xeddo"!==e.status).length,o=a.filter(e=>"Conclu\xeddo"===e.status).length;return{periodo:{inicio:e.data_inicio,fim:e.data_fim},resumo:{total_atendimentos:r,atendimentos_urgentes:n,atendimentos_concluidos:o,taxa_conclusao:r>0?Math.round(o/r*100):0},distribuicao:{por_status:Object.entries(t).map(([e,a])=>({status:e,quantidade:a,percentual:Math.round(a/r*100)})),por_urgencia:Object.entries(s).map(([e,a])=>({urgencia:e,quantidade:a,percentual:Math.round(a/r*100)})),por_canal:Object.entries(i).map(([e,a])=>({canal:e,quantidade:a,percentual:Math.round(a/r*100)})),por_secretaria:Object.entries(l).map(([e,a])=>({secretaria:e,quantidade:a,percentual:Math.round(a/r*100)}))}}}catch(e){throw console.error("Erro ao obter estat\xedsticas:",e),Error(e.message||x.X.ERROR.RELATORIO_GENERATE)}}};var m=r(4752),p=r(4389),g=r(5718),h=r(6243),y=r(5256),b=r(4409),j=r(3057),_=r(9059),f=r(1066),N=r(5735),v=r(4312),E=r(6206),k=r(467);function FilterTags({tags:e,onRemove:a,onClearAll:r,className:s}){return 0===e.length?null:(0,t.jsxs)(h.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:(0,k.cn)("flex flex-wrap items-center gap-2",s),children:[t.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Filtros ativos:"}),t.jsx(g.M,{mode:"popLayout",children:e.map(e=>(0,t.jsxs)(h.E.span,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.15},className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-900/30 dark:text-primary-300 border border-primary-200 dark:border-primary-800",children:[e.category&&(0,t.jsxs)("span",{className:"text-primary-600 dark:text-primary-400 font-semibold",children:[e.category,":"]}),t.jsx("span",{className:"truncate max-w-[150px]",children:e.label}),t.jsx("button",{onClick:()=>a(e.value),className:"hover:bg-primary-200 dark:hover:bg-primary-800 rounded-full p-0.5 transition-colors min-h-[20px] min-w-[20px] flex items-center justify-center","aria-label":`Remover filtro ${e.label}`,children:t.jsx(E.Z,{className:"w-3 h-3"})})]},e.value))}),r&&e.length>1&&(0,t.jsxs)(h.E.button,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},onClick:r,className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 border border-red-200 dark:border-red-800 transition-colors",children:[t.jsx(E.Z,{className:"w-3 h-3"}),"Limpar todos"]})]})}function RelatoriosPage(){let{showToast:e}=(0,p.p)(),a=new Date,r=new Date(a.getFullYear(),a.getMonth(),1).toISOString().split("T")[0],d=a.toISOString().split("T")[0],[u,E]=(0,s.useState)(r),[k,R]=(0,s.useState)(d),[S,w]=(0,v._)("relatorios_status",[]),[O,A]=(0,v._)("relatorios_urgencia",[]),[C,I]=(0,v._)("relatorios_secretarias",[]),[T,P]=(0,s.useState)(!1),{data:q,isFetching:X,refetch:G}=(0,i.a)({queryKey:["relatorios",{dataInicio:u,dataFim:k,status:S,urgencia:O,secretarias:C}],queryFn:()=>RelatoriosService.obterEstatisticasRelatorio({data_inicio:u,data_fim:k,status:S,urgencia:O,secretarias:C}),enabled:!1}),handleGerar=async()=>{P(!1);let a=await G();a.error?e(x.X.ERROR.RELATORIO_GENERATE,"error"):(a.data?.resumo.total_atendimentos===0&&e(x.X.WARNING.NO_DATA_FILTERS,"warning"),P(!0))},M=(0,s.useMemo)(()=>[{titulo:"Total de atendimentos",valor:q?.resumo.total_atendimentos??"—",icon:y.Z},{titulo:"Urgentes em aberto",valor:q?.resumo.atendimentos_urgentes??"—",icon:b.Z},{titulo:"Taxa de conclus\xe3o",valor:q?`${q.resumo.taxa_conclusao}%`:"—",icon:j.Z}],[q]),L=(0,s.useMemo)(()=>{let e=[];return S.forEach(a=>e.push({label:a,value:`status-${a}`,category:"Status"})),O.forEach(a=>e.push({label:a,value:`urgencia-${a}`,category:"Urg\xeancia"})),C.forEach(a=>e.push({label:a,value:`secretaria-${a}`,category:"Secretaria"})),e},[S,O,C]);return t.jsx(l.c,{children:(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-neutral-900 pb-10 safe-area-bottom",children:[(0,t.jsxs)("div",{className:"px-4 pt-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Relat\xf3rios"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Gere e visualize relat\xf3rios de atendimentos"})]}),(0,t.jsxs)(o.Zb,{className:"m-4 p-4 md:p-6 dark:bg-neutral-800 dark:border-neutral-700",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Data In\xedcio"}),(0,t.jsxs)("div",{className:"relative",children:[t.jsx(_.Z,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),t.jsx(c.I,{type:"date",value:u,onChange:e=>E(e.target.value),className:"pl-9 dark:bg-neutral-700 dark:border-neutral-600 dark:text-gray-100"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Data Fim"}),(0,t.jsxs)("div",{className:"relative",children:[t.jsx(_.Z,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),t.jsx(c.I,{type:"date",value:k,onChange:e=>R(e.target.value),className:"pl-9 dark:bg-neutral-700 dark:border-neutral-600 dark:text-gray-100"})]})]}),t.jsx("div",{className:"md:col-span-2",children:t.jsx(n.z,{onClick:handleGerar,disabled:X,"aria-label":"Gerar relat\xf3rio",className:"w-full md:w-auto mobile-button min-h-[44px]",children:X?(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[t.jsx(f.Z,{className:"w-4 h-4 animate-spin"})," ",x.X.INFO.GENERATING_REPORT]}):"Gerar Relat\xf3rio"})})]}),(0,t.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),t.jsx(N.h,{items:m.CX,multiple:!0,value:S,onChange:w,placeholder:"Selecione status",ariaLabel:"Filtrar por status",showChips:!1})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Urg\xeancia"}),t.jsx(N.h,{items:m.Qr,multiple:!0,value:O,onChange:A,placeholder:"Selecione urg\xeancias",ariaLabel:"Filtrar por urg\xeancia",showChips:!1})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Secretarias"}),t.jsx(N.h,{items:m.At,multiple:!0,value:C,onChange:I,placeholder:"Selecione secretarias",ariaLabel:"Filtrar por secretarias",showChips:!1})]})]}),L.length>0&&t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-neutral-700",children:t.jsx(FilterTags,{tags:L,onRemove:e=>{e.startsWith("status-")?w(S.filter(a=>`status-${a}`!==e)):e.startsWith("urgencia-")?A(O.filter(a=>`urgencia-${a}`!==e)):e.startsWith("secretaria-")&&I(C.filter(a=>`secretaria-${a}`!==e))},onClearAll:()=>{w([]),A([]),I([])}})})]}),t.jsx("div",{className:"px-4",children:t.jsx(g.M,{children:T&&t.jsx(h.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.25},className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:M.map(({titulo:e,valor:a,icon:r},s)=>t.jsx(h.E.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.05*s},children:(0,t.jsxs)(o.Zb,{className:"p-6 dark:bg-neutral-800 dark:border-neutral-700",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e}),t.jsx(r,{className:"w-5 h-5 text-gray-400"})]}),t.jsx("p",{className:"text-3xl font-bold mt-1 text-gray-900 dark:text-gray-100",children:a})]})},e))})})}),t.jsx("div",{className:"px-4 mt-4",children:t.jsx(g.M,{children:T&&(0,t.jsxs)(h.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.25},className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,t.jsxs)(o.Zb,{className:"p-6 dark:bg-neutral-800 dark:border-neutral-700",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Por status"}),t.jsx("ul",{className:"space-y-2",children:q?.distribuicao.por_status.length?q.distribuicao.por_status.map(e=>(0,t.jsxs)("li",{className:"flex justify-between text-sm text-gray-700 dark:text-gray-200",children:[t.jsx("span",{children:e.status}),(0,t.jsxs)("span",{children:[e.quantidade," (",e.percentual,"%)"]})]},e.status)):t.jsx("li",{className:"text-sm text-gray-500 dark:text-gray-400",children:x.X.WARNING.NO_DATA})})]}),(0,t.jsxs)(o.Zb,{className:"p-6 dark:bg-neutral-800 dark:border-neutral-700",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Por urg\xeancia"}),t.jsx("ul",{className:"space-y-2",children:q?.distribuicao.por_urgencia.length?q.distribuicao.por_urgencia.map(e=>(0,t.jsxs)("li",{className:"flex justify-between text-sm text-gray-700 dark:text-gray-200",children:[t.jsx("span",{children:e.urgencia}),(0,t.jsxs)("span",{children:[e.quantidade," (",e.percentual,"%)"]})]},e.urgencia)):t.jsx("li",{className:"text-sm text-gray-500 dark:text-gray-400",children:x.X.WARNING.NO_DATA})})]}),(0,t.jsxs)(o.Zb,{className:"p-6 dark:bg-neutral-800 dark:border-neutral-700",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Por canal"}),t.jsx("ul",{className:"space-y-2",children:q?.distribuicao.por_canal.length?q.distribuicao.por_canal.map(e=>(0,t.jsxs)("li",{className:"flex justify-between text-sm text-gray-700 dark:text-gray-200",children:[t.jsx("span",{children:e.canal}),(0,t.jsxs)("span",{children:[e.quantidade," (",e.percentual,"%)"]})]},e.canal)):t.jsx("li",{className:"text-sm text-gray-500 dark:text-gray-400",children:x.X.WARNING.NO_DATA})})]}),(0,t.jsxs)(o.Zb,{className:"p-6 dark:bg-neutral-800 dark:border-neutral-700",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Por secretaria"}),t.jsx("ul",{className:"space-y-2",children:q?.distribuicao.por_secretaria.length?q.distribuicao.por_secretaria.map(e=>(0,t.jsxs)("li",{className:"flex justify-between text-sm text-gray-700 dark:text-gray-200",children:[t.jsx("span",{children:e.secretaria}),(0,t.jsxs)("span",{children:[e.quantidade," (",e.percentual,"%)"]})]},e.secretaria)):t.jsx("li",{className:"text-sm text-gray-500 dark:text-gray-400",children:x.X.WARNING.NO_DATA})})]})]})})}),(0,t.jsxs)("div",{className:"px-4 mt-4 flex flex-col sm:flex-row gap-2",children:[t.jsx(n.z,{onClick:async()=>{try{"undefined"!=typeof navigator&&navigator.vibrate&&navigator.vibrate(10);let a=await RelatoriosService.exportarCSV({data_inicio:u,data_fim:k,status:S,urgencia:O,secretarias:C});RelatoriosService.baixarArquivo(a,`relatorio_${u}_${k}.csv`),e(x.X.SUCCESS.RELATORIO_EXPORTED,"success")}catch(a){e(a?.message||x.X.ERROR.RELATORIO_EXPORT,"error")}},"aria-label":"Exportar CSV",className:"mobile-button min-h-[44px]",children:"Exportar CSV"}),t.jsx(n.z,{variant:"outline",onClick:async()=>{try{"undefined"!=typeof navigator&&navigator.vibrate&&navigator.vibrate(10);let a=await RelatoriosService.exportarCSV({data_inicio:u,data_fim:k,status:S,urgencia:O,secretarias:C});RelatoriosService.baixarArquivo(a,`relatorio_${u}_${k}.csv`),e(x.X.SUCCESS.RELATORIO_EXPORTED,"success")}catch(a){e(a?.message||x.X.ERROR.RELATORIO_EXPORT,"error")}},"aria-label":"Exportar Excel (CSV)",className:"mobile-button dark:border-neutral-600 dark:text-gray-200 dark:hover:bg-neutral-700 min-h-[44px]",children:"Exportar Excel (CSV)"})]})]})})}},4752:(e,a,r)=>{"use strict";r.d(a,{At:()=>t,CX:()=>s,Qr:()=>i,Sv:()=>n,n$:()=>l});let t=["Secretaria de Sa\xfade","Secretaria de Educa\xe7\xe3o","Secretaria de Assist\xeancia Social","Secretaria de Obras","Secretaria de Meio Ambiente","Secretaria de Transporte","Secretaria de Cultura","Secretaria de Esporte"],s=["Pendente","Em Andamento","Conclu\xeddo","Cancelado"],i=["Baixa","M\xe9dia","Alta","Urgente"],l=["Presencial","Telefone","WhatsApp","E-mail","Outro"],n=["Secretaria","Informa\xe7\xe3o","Orienta\xe7\xe3o","Outro"]},5546:(e,a,r)=>{"use strict";r.r(a),r.d(a,{$$typeof:()=>l,__esModule:()=>i,default:()=>o});var t=r(5153);let s=(0,t.createProxy)(String.raw`/workspaces/app-acessoria-parlamentar/src/app/relatorios/page.tsx`),{__esModule:i,$$typeof:l}=s,n=s.default,o=n}};var a=require("../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),r=a.X(0,[447,887,796,511,596,993,58,718,159,570,839,761,215,505,973,627],()=>__webpack_exec__(6300));module.exports=r})();